name: ğŸ”’ Security Check

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    # Scan de sÃ©curitÃ© chaque lundi Ã  9h UTC
    - cron: '0 9 * * 1'

jobs:
  security_scan:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ” Scan for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: main
          head: HEAD

      - name: ğŸ”’ Go security scan
        if: hashFiles('ArboreBackend/go.mod') != ''
        working-directory: ./ArboreBackend
        run: |
          go install golang.org/x/vuln/cmd/govulncheck@latest
          govulncheck ./... || echo "VulnerabilitÃ©s trouvÃ©es dans le code Go"

      - name: ğŸ Python security scan
        if: hashFiles('AiGenerator/requirements.txt') != '' || hashFiles('AiGenerator/main.py') != ''
        working-directory: ./AiGenerator
        run: |
          pip install safety
          safety check || echo "VulnerabilitÃ©s trouvÃ©es dans les dÃ©pendances Python"

      - name: ğŸ“Š Security Summary
        if: always()
        run: |
          echo "ğŸ”’ Scan de sÃ©curitÃ© Arbore terminÃ©"
          echo "VÃ©rifiez les logs ci-dessus pour d'Ã©ventuelles vulnÃ©rabilitÃ©s"
